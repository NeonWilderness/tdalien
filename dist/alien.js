!function(e){var t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(i,s,function(t){return e[t]}.bind(null,s));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t,n){},function(e,t,n){var i,s,o;o=function(){return function(){return function(e){var t=[];if(e[0].match(/^[^\/:]+:\/*$/)&&e.length>1){var n=e.shift();e[0]=n+e[0]}e[0].match(/^file:\/\/\//)?e[0]=e[0].replace(/^([^\/:]+):\/*/,"$1:///"):e[0]=e[0].replace(/^([^\/:]+):\/*/,"$1://");for(var i=0;i<e.length;i++){var s=e[i];if("string"!=typeof s)throw new TypeError("Url must be a string. Received "+s);""!==s&&(i>0&&(s=s.replace(/^[\/]+/,"")),s=i<e.length-1?s.replace(/[\/]+$/,""):s.replace(/[\/]+$/,"/"),t.push(s))}var o=t.join("/"),r=(o=o.replace(/\/(\?|&|#[^!])/g,"$1")).split("?");return o=r.shift()+(r.length>0?"?":"")+r.join("&")}("object"==typeof arguments[0]?arguments[0]:[].slice.call(arguments))}},e.exports?e.exports=o():void 0===(s="function"==typeof(i=o)?i.call(t,n,t,e):i)||(e.exports=s)},function(e,t,n){"use strict";n.r(t);n(0);const i=e=>{let t={title:e.title,published:e.published,link:e.link,comments:e.comments,postid:e.postid};return`<p>${e.contentSnippet||"..."}</p>\n<div style="text-align:center"><a target="_blank" href="${e.link}">&raquo; Beitrag</a>&emsp;&emsp;<a target="_blank" href="${e.commentUrl}">&raquo; Kommentare</a></div>\n<div class="alienStatus" style="display:none">${JSON.stringify(t,null,2)}</div>`},s=(e,t,n)=>{toastr.error(`Fehler beim ${e} von ${t}: ${n.status} | ${n.statustext}.`)},o=e=>{let t=$(e).find("form");return{secretKey:t.find("[name=secretKey]").val(),action:t.find('[name="action"]').val(),key:t.find('[name="key"]').val(),skinset:t.find('[name="skinset"]').val(),module:t.find('[name="module"]').val(),title:t.find('[name="title"]').val(),description:t.find('[name="description"]').html(),skin:t.find("[name=skin]").val(),save:t.find('[name="save"]').val()}},r=()=>new Promise((e,t)=>{let n=$.get("/layouts/alien/skins/edit?key=Site.implant",function(t){let n=o(t);e(n)}).fail(()=>{s("Lesen(get)","Skin Site.implant",n),t()})}),l=e=>new Promise((t,n)=>{let i=$.post("/layouts/alien/skins/edit?key=Site.implant",e,function(){t()}).fail(()=>{s("Update(post)","Skin Site.implant",i),n()})}),a=()=>new Promise((e,t)=>{let n=$.get("/layouts/alien/skins/edit?key=Site.stories",function(t){let n=o(t),i=JSON.parse(n.skin);i.forEach(e=>{e.published=new Date(e.published)}),e({params:n,skinStories:i})}).fail(()=>{s("Lesen(get)","Skin Site.stories",n),t()})}),c=e=>new Promise((t,n)=>{let i=$.post("/layouts/alien/skins/edit?key=Site.stories",e,function(){t()}).fail(()=>{s("Update(post)","Skin Site.stories",i),n()})}),d=(e,t)=>new Promise((n,i)=>{let o=$.get("/stories/main",function(i){let s={};$(i).find(".admin").find(".storyData").each(function(){let[e,n,i]=this.innerText.split("|"),o=new Date(i).getTime();o in s&&(t.cleanup.push(s[o]),t.debug&&console.log(`Duplicate story id detected: ${s[o]}`)),s[o]=n,t.debug&&console.log(`storyData> title: ${e}, pubDate: ${i} (${o}), id: ${n}`)});let o=Object.keys(e).reduce((n,i)=>{let o=e[i],r=o.published.getTime();return t.debug&&console.log(`Searching story: ${o.title}, published: ${o.published} (${r}), found: ${s.hasOwnProperty(r)}`),s.hasOwnProperty(r)&&(o.id=s[r]),n.push(o),n},[]);n(o)}).fail(()=>{s("Lesen(get)","Twoday Beitragsübersicht",o),i()})}),u=e=>{let t=$(e).find("form"),n=t.find('[name="discussions"]');return{secretKey:t.find('[name="secretKey"]').val(),content_title:t.find('[name="content_title"]').val(),modNiceUrls_urlid:t.find('[name="modNiceUrls_urlid"]').val(),content_text:t.find('[name="content_text"]').val(),addToFront:t.find('[name="addToFront"]').val(),checkbox_addToFront:t.find('[name="checkbox_addToFront"]').val(),addToTopic:t.find('[name="addToTopic"]').val(),topic:t.find('[name="topic"]').val(),editableby:t.find('[name="editableby"]').val(),discussions:n.prop("checked")?n.val():null,checkbox_discussions:t.find('[name="checkbox_discussions"]').val(),createtime:t.find('[name="createtime"]').val(),publish:t.find('[name="publish"]').val()}},p=(e,t,n)=>{return`${n.titlePrefix.replace("$comments",t)}${e||"..."}${n.titlePostfix.replace("$comments",t)}`},m=(e,t)=>{var n={};t.cleanup=[],a().then(({params:i,skinStories:s})=>{t.debug&&console.log("readStoriesSkinContent: ",s),n=i;const o=((e,t)=>{let n=e.length&&e[0].postid.length&&(0===t.length||t.length&&"postid"in t[0]&&t[0].postid.length)?e=>e.postid:e=>e.published.getTime(),i=e.reduce((e,t)=>(e[n(t)]=t,e),{});return t.reduce((e,t)=>{let i=n(t);return e.hasOwnProperty(i)&&((e,t)=>e.comments==t.comments&&e.title==t.title&&e.contentSnippet==t.contentSnippet)(e[i],t)&&delete e[i],e},i)})(e,s);return Object.keys(o).length>0?d(o,t):Promise.resolve([])}).then(e=>{if(t.debug&&console.log("finalStories: ",e),e&&e.length){let n=e.map(e=>e.hasOwnProperty("id")?((e,t)=>new Promise((n,o)=>{let r=`/stories/${e.id}/edit`,l=$.get(r,function(a){e.alienLastUpdate=(new Date).toISOString();let c=u(a),d=$(`<div>${c.content_text}</div>`),m=d.find(".alienStatus");m.length?m.text(JSON.stringify(e,null,2)):d.append(i(e)),c.content_title=p(e.title,e.comments,t),c.content_text=d.html(),c.createtime=`${e.published.toISOString().substr(0,10)} ${e.published.toTimeString().substr(0,5)}`,null==c.discussions&&delete c.discussions,l=$.post(r,c,function(){toastr.info(`Beitrag ${e.title} vom ${e.published.toLocaleString()} in Twoday aktualisiert.`),n()}).fail(()=>{s("Update(post)",`Twoday-Beitrag ${e.id}`,l),o()})}).fail(()=>{s("Update(get)",`Twoday-Beitrag ${e.id}`,l),o()})}))(e,t):((e,t)=>new Promise((n,o)=>{let r=$.get("/stories/create",function(l){e.alienLastUpdate=(new Date).toISOString();let a=u(l);a.content_title=p(e.title,e.comments,t),a.content_text=i(e),a.createtime=`${e.published.toISOString().substr(0,10)} ${e.published.toTimeString().substr(0,5)}`,t.allowComments||delete a.discussions,r=$.post("/stories/create",a,function(){toastr.info(`Beitrag ${e.title} vom ${e.published.toLocaleString()} in Twoday neu angelegt.`),n()}).fail(()=>{s("Anlegen(post)",`Twoday-Beitrag ${e.id}`,r),o()})}).fail(()=>{s("Anlegen(get)",`Twoday-Beitrag ${e.id}`,r),o()})}))(e,t));return Promise.all(n)}return toastr.info("Keine neuen zu synchronisierenden Änderungen gefunden!"),!1}).then(()=>{let t=JSON.stringify(e,null,2);return n.skin!==t?(n.skin=t,c(n)):Promise.resolve()}).then(()=>t.cleanup.length?Promise.all(t.cleanup.map(e=>((e,t)=>new Promise((n,i)=>{let o=`/stories/${e}/delete`,r=$.get(o,function(l){let a={secretKey:$(l).find("form").find("[name=secretKey]").val(),remove:"Löschen"};r=$.post(o,a,function(){t.debug&&console.log(`Duplicate story ${e} was successfully removed.`),n()}).fail(()=>{s("Entfernen(post)",`Twoday-Beitrag ${e}`,r),i()})}).fail(()=>{s("Lesen(get)",`Twoday-Beitrag ${e}`,r),i()})}))(e,t))):Promise.resolve()).then(()=>{toastr.success("Synchronisation erfolgreich abgeschlossen.")}).catch(e=>toastr.error(`Synchronisation endete mit Fehler: ${e}.`))},h=n(1);class g{constructor(){this.defaults={targetUrl:"https://die-netzialisten.de",rssFeedUrl:"feed",titleField:"title",publishedField:"pubDate",commentsField:"comments",counterField:"commentCount",allowComments:!0,pauseChecks:12e4,syncStories:3,targetStory:!0,titlePrefix:"",titlePostfix:" - ✉ $comments",colorAlias:"#13c4a5",colorNavIcon:"#13c4a5",positionToast:"toast-top-full-width",menuOffsetTop:0,menuOffsetRight:0,delayNewRelease:1728e5,debug:!1},this.providerPostIdReg={wordpress:/\?p=([0-9]*)/,nuxtjs:/\/([^\/]+)\/?$/,blogger:/post-([0-9]*)/,tumblr:/post\/([0-9]*)/},this.webtaskUrl="https://wt-061cbc2118e775aa9f3fe9182b7691db-0.sandbox.auth0-extend.com/getrss"}checkNewVersionAvailability(){let e=localStorage.getItem("delayAlienRelease");if(e&&Date.now()<=e)return;let t=this;$.getJSON("https://cdn.jsdelivr.net/gh/NeonWilderness/tdalien@latest/package.json",function(e){let n=t.parseVersion(document.body.dataset.version);t.parseVersion(e.version)>n&&($("#btnClose, #btnCancel").on("click",function(e){if(e.preventDefault(),$("#newVersion").fadeOut(),"btnClose"===e.target.id){let e=Date.now()+t.options.delayNewRelease;localStorage.setItem("delayAlienRelease",e)}}),$("#btnUpdate").on("click",function(e){e.preventDefault(),$("#msgNewVersion").fadeOut(),$("#msgUpdate").fadeIn().css("display","inline-block")}),$("#btnSaveParams").on("click",function(e){e.preventDefault(),t.saveCurrentParams()}),$("#newVersion").fadeIn(900))})}getFeedsPostIdSelector(e){let t=Object.keys(this.providerPostIdReg),n="",i=0;for(;!n&&i<t.length;){let s=t[i];e.indexOf(s)>=0&&(n=s),i++}return n?this.providerPostIdReg[n]:null}getNewBlogAlias(){let e=this.options.targetUrl.replace("www.","").match(/https?:\/\/(.*?)\./i);return e?e[1]:""}gotoStory(e){$.get(e,function(t){let n=$(t).find(".alienStatus").text();if(n)try{let t=JSON.parse(n);window.location=t.link}catch(t){console.log(`Error parsing alienStatus of "${e}": ${t}.`)}})}implant(e){this.options=Object.assign({},this.defaults,e),this.options.newBlogAlias=this.getNewBlogAlias(),this.options.debug&&console.log(`Alien Options: ${JSON.stringify(this.options,null,2)}`);let t=location.pathname.toLowerCase();if(this.options.targetStory&&/\/stories\//.test(t)){let e=t.split("/"),n=e.slice(0,e.indexOf("stories")+2).join("/");this.gotoStory(n)}this.options.colorAlias=this.options.colorAlias.toLowerCase(),this.options.colorAlias!==this.defaults.colorAlias&&$("#alias").css("color",this.options.colorAlias);let n=$("#showMenu");this.options.colorNavIcon=this.options.colorNavIcon.toLowerCase(),this.options.colorNavIcon!==this.defaults.colorNavIcon&&n.css("color",this.options.colorNavIcon),this.options.menuOffsetTop&&n.css("top",8+this.options.menuOffsetTop),this.options.menuOffsetRight&&n.css("right",25+this.options.menuOffsetRight),$(".alien").each((e,t)=>{switch(t.tagName){case"A":t.href=this.options.targetUrl,this.options.newBlogAlias.length&&(t.innerHTML=t.innerHTML.replace("<% site.alias %>",this.options.newBlogAlias));break;case"IFRAME":t.src=this.options.targetUrl}}),toastr.options={closeButton:!1,newestOnTop:!1,positionClass:this.options.positionToast,progressBar:!0,timeOut:"8000"},$(`.sign${"<% username %>".length>0?"out":"in"}`).show(0).css("display","block"),this.initClickFunctions(),setTimeout(()=>{if(this.isUserAdministrator()){$(".adminOnly").show(0).css("display","block"),this.checkNewVersionAvailability(),this.restoreSavedParams();let e=$("#menuParams");this.options.targetUrl===this.defaults.targetUrl?(e.addClass("highlight"),toastr.warning('<div style="text-align:center">Bitte klicken Sie im Menü auf <b>Parameter/Einstellungen</b>, um <b>Ihren eigenen Blog</b> zu aktivieren!</div>')):(e.removeClass("highlight"),this.maySyncNow()&&this.readAlienRSS())}},2e3)}initClickFunctions(){let e=!1,t=$("#showMenu"),n=t.find("i"),i=()=>{e?document.body.classList.remove("show-menu"):document.body.classList.add("show-menu"),t.attr("title",`Menü ${e?"ein":"aus"}blenden`),n.addClass("fa-spin"),setTimeout(()=>{n.toggleClass("fa-navicon fa-close"),n.removeClass("fa-spin"),this.options.menuOffsetTop&&t.css("top",8+Number(!e)*this.options.menuOffsetTop),this.options.menuOffsetRight&&t.css("right",25+Number(!e)*this.options.menuOffsetRight)},500),e=!e};t.on("click",function(e){i()})}isUserAdministrator(){let e=document.getElementById("loginStatus").innerText.match(/\((.*)\)/);return!!e&&"Administrator"===e[1]}maySyncNow(){if(this.options.syncStories<1)return!1;let e=localStorage.getItem("lastAlienSync"),t=new Date,n=!e||new Date(e).getTime()+this.options.pauseChecks<t.getTime();return n&&localStorage.setItem("lastAlienSync",t),n}parseVersion(e){return parseInt(e.replace(/\./g,""))}readAlienRSS(){let e=this;$.getJSON(`${this.webtaskUrl}?url=${h(this.options.targetUrl,this.options.rssFeedUrl)}`,function(t){if(t.items&&t.items.length>0){let n=e.readStoriesFromRssData(t);e.options.debug&&console.log("Parsed RSS stories: ",n),m(n,e.options)}}).fail(function(e,t,n){console.error(`Webtask getrss error: ${t} | ${n}.`)})}readStoriesFromRssData(e){this.options.debug&&console.log(`Webtask getrss items: ${JSON.stringify(e,null,2)}`);let t=this.getFeedsPostIdSelector(e.generator);return e.items.reduce((n,i)=>{let s="";if(t){let e=(i.guid||i.id).match(t);e&&(s=e[1])}let o=i[this.options.publishedField].split(":");o[o.length-1]="00 "+o[o.length-1].substr(3);let r={postid:s,link:i.link||e.link,contentSnippet:i.contentSnippet.replace(/(Read More|Weiterlesen)/gi,""),title:i[this.options.titleField]||"...",published:new Date(o.join(":")),commentUrl:i[this.options.commentsField]||`${i.link}#comments`,comments:i[this.options.counterField]||0};return n.push(r),n},[]).sort((e,t)=>t.published.getTime()-e.published.getTime()).slice(0,this.options.syncStories)}restoreSavedParams(){let e=localStorage.getItem("savedAlienVersion"),t=localStorage.getItem("savedAlienSkinStories"),n=localStorage.getItem("savedAlienSkinParams");e&&t&&n&&(this.parseVersion(document.body.dataset.version)<=this.parseVersion(e)||a().then(({params:e})=>(e.skin=t,c(e))).then(()=>r()).then(e=>(e.skin=n,l(e))).then(()=>{localStorage.removeItem("savedAlienVersion"),toastr.success("Ihre Parameter und Einstellungen wurden erfolgreich wiederhergestellt!"),toastr.info('Bitte laden Sie nun die Seite neu per "Hard-Reload" (Windows: Strg-F5, Mac: Cmd-R).')}).catch(e=>toastr.error(`Die Wiederherstellung der Parameter/Einstellungen endete mit Fehler: ${e}.`)))}saveCurrentParams(){a().then(({skinStories:e})=>(localStorage.setItem("savedAlienSkinStories",JSON.stringify(e)),r())).then(e=>{localStorage.setItem("savedAlienSkinParams",e.skin),localStorage.setItem("savedAlienVersion",document.body.dataset.version),toastr.success("Ihre Parameter und Einstellungen wurden erfolgreich gesichert!")}).catch(e=>toastr.error(`Die Sicherung der Parameter/Einstellungen endete mit Fehler: ${e}.`))}}jQuery.fn.alien=function(){let e=new g;return{implant:e.implant.bind(e)}}}]);
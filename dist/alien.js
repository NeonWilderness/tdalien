!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t,n){},function(e,t,n){var i,o,r;r=function(){function e(e){var t=[];if(0===e.length)return"";if("string"!=typeof e[0])throw new TypeError("Url must be a string. Received "+e[0]);if(e[0].match(/^[^/:]+:\/*$/)&&e.length>1){var n=e.shift();e[0]=n+e[0]}e[0].match(/^file:\/\/\//)?e[0]=e[0].replace(/^([^/:]+):\/*/,"$1:///"):e[0]=e[0].replace(/^([^/:]+):\/*/,"$1://");for(var i=0;i<e.length;i++){var o=e[i];if("string"!=typeof o)throw new TypeError("Url must be a string. Received "+o);""!==o&&(i>0&&(o=o.replace(/^[\/]+/,"")),o=i<e.length-1?o.replace(/[\/]+$/,""):o.replace(/[\/]+$/,"/"),t.push(o))}var r=t.join("/"),s=(r=r.replace(/\/(\?|&|#[^!])/g,"$1")).split("?");return r=s.shift()+(s.length>0?"?":"")+s.join("&")}return function(){return e("object"==typeof arguments[0]?arguments[0]:[].slice.call(arguments))}},e.exports?e.exports=r():void 0===(o="function"==typeof(i=r)?i.call(t,n,t,e):i)||(e.exports=o)},function(e,t,n){"use strict";n.r(t);n(0);function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],i=!0,o=!1,r=void 0;try{for(var s,a=e[Symbol.iterator]();!(i=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);i=!0);}catch(e){o=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(o)throw r}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var r=function(e,t,n){toastr.error("Fehler beim ".concat(e," von ").concat(t,": ").concat(n.status," | ").concat(n.statustext,"."))},s=function(e){var t=$(e).find("form");return{secretKey:t.find('[name="secretKey"]').val(),action:t.find('[name="action"]').val(),key:t.find('[name="key"]').val(),skinset:t.find('[name="skinset"]').val(),module:t.find('[name="module"]').val(),title:t.find('[name="title"]').val(),description:t.find('[name="description"]').html(),skin:t.find('[name="skin"]').val(),save:t.find('[name="save"]').val()}},a=function(){return new Promise((function(e,t){var n=$.get("/layouts/alien/skins/edit?key=Site.implant",(function(t){var n=s(t);e(n)})).fail((function(){r("Lesen(get)","Skin Site.implant",n),t()}))}))},c=function(){return new Promise((function(e,t){var n=$.get("/layouts/alien/skins/edit?key=Site.stories",(function(t){var n=s(t),i=JSON.parse(n.skin||"[]");i.forEach((function(e){e.published=new Date(e.published)})),e({params:n,skinStories:i})})).fail((function(){r("Lesen(get)","Skin Site.stories",n),t()}))}))},l=function(e){return new Promise((function(t,n){var i=$.post("/layouts/alien/skins/edit?key=Site.stories",e,(function(){t()})).fail((function(){r("Update(post)","Skin Site.stories",i),n()}))}))},u=function(e,t,n){n.debug&&console.log("=> Story comparison rss/skin:");var i=e.reduce((function(e,t){return e[d(t.published)]=t,e}),{});return n.debug&&console.table(i),t.reduce((function(e,t){var i=d(t.published);return e.hasOwnProperty(i)&&function(e,t){if(n.debug){var i={title:e.title,comments:e.comments,snippet:e.contentSnippet},o={title:t.title,comments:t.comments,snippet:t.contentSnippet};console.table({rss:i,skin:o})}return e.comments===t.comments&&e.title===t.title&&e.contentSnippet===t.contentSnippet}(e[i],t)&&(delete e[i],n.debug&&console.log(i,"unchanged & removed.")),e}),i)},d=function(e){var t=e.toLocaleString("de-DE",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});return t.substr(0,10).split(".").reverse().join("-")+t.slice(-6)},f=function(e,t){var n={false:{url:"/stories/".concat(e.id,"/edit"),text:"aktualisiert",method:"update"},true:{url:"/stories/create",text:"neu angelegt",method:"create"}},i=!e.hasOwnProperty("id");return new Promise((function(o,s){var a=$.get(n[i].url,(function(c){e.alienLastUpdate=(new Date).toISOString();var l,u,f,p=function(e){var t=$(e).find("form"),n=t.find('[name="discussions"]');return{secretKey:t.find('[name="secretKey"]').val(),content_title:t.find('[name="content_title"]').val(),modNiceUrls_urlid:t.find('[name="modNiceUrls_urlid"]').val(),content_text:t.find('[name="content_text"]').val(),addToFront:t.find('[name="addToFront"]').val(),checkbox_addToFront:t.find('[name="checkbox_addToFront"]').val(),addToTopic:t.find('[name="addToTopic"]').val(),topic:t.find('[name="topic"]').val(),editableby:t.find('[name="editableby"]').val(),discussions:n.prop("checked")?n.val():null,checkbox_discussions:t.find('[name="checkbox_discussions"]').val(),createtime:t.find('[name="createtime"]').val(),publish:t.find('[name="publish"]').val()}}(c);p.content_title=function(e,t,n){var i=n.titlePrefix.replace("$comments",t),o=n.titlePostfix.replace("$comments",t);return"".concat(i).concat(e||"...").concat(o)}(e.title,e.comments,t),p.content_text=(u={title:(l=e).title,published:l.published,link:l.link,comments:l.comments,postid:l.postid},f=l.contentSnippet||"...","<p>".concat(f,'</p>\n<div style="text-align:center"><a target="_blank" href="').concat(l.link,'">&raquo; Beitrag</a>&emsp;&emsp;<a target="_blank" href="').concat(l.commentUrl,'">&raquo; Kommentare</a></div>\n<div class="alienStatus" style="display:none">').concat(JSON.stringify(u,null,2),"</div>")),p.createtime=d(e.published),t.allowComments&&null!=p.discussions||delete p.discussions,a=$.post(n[i].url,p,(function(){toastr.info("Beitrag ".concat(e.title," vom ").concat(e.published.toLocaleString()," in Twoday ").concat(n[i].text,".")),o()})).fail((function(){r("".concat(n[i].method,"(POST)"),'Twoday-Beitrag "'.concat(e.title,'"'),a),s()}))})).fail((function(){r("".concat(n[i].method,"(GET)"),'Twoday-Beitrag "'.concat(e.title,'"'),a),s()}))}))},p=function(e,t){var n={};c().then((function(o){var s=o.params,a=o.skinStories;t.debug&&console.log("readStoriesSkinContent: ",a),n=s;var c=u(e,a,t);return Object.keys(c).length>0?function(e,t){return new Promise((function(n,o){var s=$.get("/stories/main",(function(o){var r={};$(o).find(".admin").find(".storyData").each((function(){var e=i(this.innerText.split(":¦:"),3),n=e[0],o=e[1],s=e[2];s=s.trim(),r[s]=o,t.debug&&console.log("storyData> title: ".concat(n,", pubDate: ").concat(s,", id: ").concat(o))}));var s=Object.keys(e).reduce((function(n,i){var o=e[i];return t.debug&&console.log("Searching story: ".concat(o.title,", published: ").concat(i,", found: ").concat(r.hasOwnProperty(i))),r.hasOwnProperty(i)&&(o.id=r[i]),n.push(o),n}),[]);n(s)})).fail((function(){r("Lesen(get)","Twoday Beitragsübersicht",s),o()}))}))}(c,t):Promise.resolve([])})).then((function(e){if(t.debug&&console.log("finalStories: ",e),e&&e.length){var n=e.map((function(e,n){return(i=n*t.delayBetweenUpdates,new Promise((function(e){return setTimeout(e,i)}))).then((function(){return f(e,t)}));var i}));return Promise.all(n)}return toastr.info("Keine neuen zu synchronisierenden Änderungen gefunden!"),!1})).then((function(){var t=JSON.stringify(e,null,2);return n.skin!==t?(n.skin=t,l(n)):Promise.resolve()})).then((function(){toastr.success("Synchronisation erfolgreich abgeschlossen.")})).catch((function(e){return toastr.error("Synchronisation endete mit Fehler: ".concat(e,"."))}))},m=function(e,t){return(e.match(/[a-zA-Z]*\s*:\s*.*/g)||[]).reduce((function(e,n){var i=n.trim();","===i.slice(-1)&&(i=i.slice(0,-1));var o=i.split(":"),r=o[0].trim();if(r in t){var s=o.slice(1).join(":").trim();e.push({key:r,setting:s})}return e}),[])};function h(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var g=n(1),v=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.defaults={targetUrl:"https://die-netzialisten.de",rssFeedUrl:"feed",titleField:"title",publishedField:"pubDate",commentsField:"comments",counterField:"commentCount",allowComments:!0,pauseChecks:12e4,syncStories:3,targetStory:!0,titlePrefix:"✉ $comments - ",titlePostfix:"",colorAlias:"#f7cf5e",colorNavIcon:"#f7cf5e",positionToast:"toast-top-full-width",menuOffsetTop:0,menuOffsetRight:0,delayNewRelease:1728e5,delayBetweenUpdates:400,redirectToNewSite:!0,needUpdateLevel:"Owner",debug:!1},this.providerPostIdReg={wordpress:/\?p=([0-9]*)/,nuxtjs:/\/([^/]+)\/?$/,blogger:/post-([0-9]*)/,tumblr:/post\/([0-9]*)/},this.webtaskUrl="https://wt-061cbc2118e775aa9f3fe9182b7691db-0.sandbox.auth0-extend.com/getrss",this.appUser="YmxvZWRiYWJibGVyfGZvdW5kYXRpb258S3VsdHVyZmxhbmV1cnxtbW18TmJlcmxpbnxOZW9uV2lsZGVybmVzc3xzcGllZ2VsZWl8dGFsa3N0cmFpZ2h0fHdlbHRlbnRhbno=",this.noAlien="PGltZyBzcmM9Ii9sYXlvdXRzL2FsaWVuL2ltYWdlcy9ub2FsaWVuIiB3aWR0aD0iMTAwJSIgLz4="}var t,n,i;return t=e,(n=[{key:"checkNewVersionAvailability",value:function(){var e=localStorage.getItem("delayAlienRelease");if(!(e&&Date.now()<=e)){var t=this;$.getJSON("https://cdn.jsdelivr.net/gh/NeonWilderness/tdalien@latest/package.json",(function(e){t.parseVersion(e.version)>t.options.version&&($("#btnClose, #btnCancel").on("click",(function(e){if(e.preventDefault(),$("#newVersion").fadeOut(),"btnClose"===e.target.id){var n=Date.now()+t.options.delayNewRelease;localStorage.setItem("delayAlienRelease",n)}})),$("#btnUpdate").on("click",(function(e){e.preventDefault(),$("#msgNewVersion").fadeOut(),$("#msgUpdate").fadeIn().css("display","inline-block")})),$("#btnSaveParams").on("click",(function(e){e.preventDefault(),t.saveCurrentParams()})),$("#newVersion").fadeIn(900))}))}}},{key:"getFeedsPostIdSelector",value:function(e){for(var t=Object.keys(this.providerPostIdReg),n="",i=0;!n&&i<t.length;){var o=t[i];e.indexOf(o)>=0&&(n=o),i++}return n?this.providerPostIdReg[n]:null}},{key:"getNewBlogAlias",value:function(){var e=this.options.targetUrl.replace("www.","").match(/https?:\/\/(.*?)\./i);return e?e[1]:""}},{key:"implant",value:function(e){var t=this;if(this.options=Object.assign({},this.defaults,e),this.options.newBlogAlias=this.getNewBlogAlias(),this.options.version=this.parseVersion(document.body.dataset.version),this.options.debug&&console.log("Alien Options: ".concat(JSON.stringify(this.options,null,2))),!this.isAppUser())return $("#frame").attr("srcdoc",atob(this.noAlien)),void $("#showMenu").attr("title","Zur Layoutübersicht").click((function(){window.location.href="/layouts"}));var n=this.options.targetUrl;if(this.options.targetStory){var i=$(".alienStatus").text();if(i)try{var o=JSON.parse(i);o.link&&(n=o.link)}catch(e){}}this.options.debug&&console.log("Using iframe url: ".concat(n,"."));var r=this.options.needUpdateLevel.toString().toLowerCase().substr(0,5);this.options.debug&&console.log("Required update level: ".concat(r));var s="<% username %>"===$("#createInfo>a").text(),a=this.isUserAdministrator(),c="owner"===r&&s||"admin"===r&&a;if(!c&&this.options.redirectToNewSite)return this.options.debug&&console.log("Redirecting to new site."),window.location.replace(n),!1;this.options.colorAlias=this.options.colorAlias.toLowerCase(),this.options.colorAlias!==this.defaults.colorAlias&&$("#alias").css("color",this.options.colorAlias);var l=$("#showMenu");this.options.colorNavIcon=this.options.colorNavIcon.toLowerCase(),this.options.colorNavIcon!==this.defaults.colorNavIcon&&l.css("color",this.options.colorNavIcon),this.options.menuOffsetTop&&l.css("top",8+this.options.menuOffsetTop),this.options.menuOffsetRight&&l.css("right",25+this.options.menuOffsetRight),$(".alien").each((function(e,i){switch(i.tagName){case"A":i.href=t.options.targetUrl,t.options.newBlogAlias.length&&(i.innerHTML=i.innerHTML.replace("<% site.alias %>",t.options.newBlogAlias));break;case"IFRAME":i.src=n}})),toastr.options={closeButton:!1,newestOnTop:!1,positionClass:this.options.positionToast,progressBar:!0,timeOut:"8000"},$(".sign".concat("<% username %>".length>0?"out":"in")).show(0).css("display","block"),this.initClickFunctions(),setTimeout((function(){if(c){$(".adminOnly").show(0).css("display","block"),t.checkNewVersionAvailability(),t.restoreSavedParams();var e=$("#menuParams");t.options.targetUrl===t.defaults.targetUrl?(e.addClass("highlight"),toastr.warning('<div style="text-align:center">Bitte klicken Sie im Menü auf <b>Parameter/Einstellungen</b>, um <b>Ihren eigenen Blog</b> zu aktivieren!</div>')):(e.removeClass("highlight"),t.maySyncNow()&&t.readAlienRSS())}}),2e3)}},{key:"initClickFunctions",value:function(){var e=this,t=!1,n=$("#showMenu"),i=n.find("i");n.on("click",(function(o){t?document.body.classList.remove("show-menu"):document.body.classList.add("show-menu"),n.attr("title","Menü ".concat(t?"ein":"aus","blenden")),i.addClass("fa-spin"),setTimeout((function(){i.toggleClass("fa-navicon fa-close"),i.removeClass("fa-spin"),e.options.menuOffsetTop&&n.css("top",8+Number(!t)*e.options.menuOffsetTop),e.options.menuOffsetRight&&n.css("right",25+Number(!t)*e.options.menuOffsetRight)}),500),t=!t}))}},{key:"isAppUser",value:function(){var e=document.getElementById("alias").innerText||"";return atob(this.appUser).split("|").indexOf(e)>=0}},{key:"isUserAdministrator",value:function(){var e=document.getElementById("loginStatus").innerText.match(/\((.*)\)/);return!!e&&"Administrator"===e[1]}},{key:"maySyncNow",value:function(){if(this.options.syncStories<1)return!1;var e=localStorage.getItem("lastAlienSync"),t=new Date,n=!e||new Date(e).getTime()+this.options.pauseChecks<t.getTime();return n&&localStorage.setItem("lastAlienSync",t),n}},{key:"parseVersion",value:function(e){return e.split(".").reduce((function(e,t,n){return e+=t*Math.pow(100,2-n)}),0)}},{key:"readAlienRSS",value:function(){var e=this;$.getJSON("".concat(this.webtaskUrl,"?url=").concat(g(this.options.targetUrl,this.options.rssFeedUrl)),(function(t){if(t.items&&t.items.length>0){var n=e.readStoriesFromRssData(t);e.options.debug&&console.log("Parsed RSS stories: ",n),p(n,e.options)}})).fail((function(e,t,n){console.error("Webtask getrss error: ".concat(t," | ").concat(n,"."))}))}},{key:"readStoriesFromRssData",value:function(e){var t=this;this.options.debug&&console.log("Webtask getrss items: ".concat(JSON.stringify(e,null,2)));var n=this.getFeedsPostIdSelector(e.generator.toLowerCase());return e.items.reduce((function(i,o){var r="";if(n){var s=(o.guid||o.id).match(n);s&&(r=s[1])}!r&&o.postid&&o.postid._&&(r=o.postid._);var a=new Date(o[t.options.publishedField]);a.setSeconds(0,0);var c="string"!=typeof o.contentSnippet?"...":o.contentSnippet.replace(/ Werbeanzeigen/gi,"");"."!==c.slice(-1)&&(c+="…");var l={postid:r,link:o.link||e.link,contentSnippet:c,title:o[t.options.titleField]||"...",published:a,commentUrl:o[t.options.commentsField]||"".concat(o.link,"#comments"),comments:o[t.options.counterField]||0};return t.options.debug&&console.log("story: ".concat(JSON.stringify(l,null,2))),i.push(l),i}),[]).sort((function(e,t){return t.published.getTime()-e.published.getTime()})).slice(0,this.options.syncStories)}},{key:"restoreSavedParams",value:function(){var e=this,t=localStorage.getItem("savedAlienVersion"),n=localStorage.getItem("savedAlienSkinStories"),i=localStorage.getItem("savedAlienSkinParams");t&&n&&i&&(this.parseVersion(document.body.dataset.version)<=this.parseVersion(t)||c().then((function(e){var t=e.params;return t.skin=n,l(t)})).then((function(){return a()})).then((function(t){return function(e,t,n){var i=m(t,n);console.log("User Alien Options BEFORE Upgrade:\n",i),i.forEach((function(t){var n=new RegExp("".concat(t.key,"\\s*:\\s*(.*)")),i=e.skin.match(n);if(i){var o=","===i[0].slice(-1);e.skin=e.skin.replace(i[0],"".concat(t.key,": ").concat(t.setting).concat(o?",":""))}})),console.log("\nUser Alien Options AFTER Upgrade:\n",m(e.skin,n))}(t,i,e.options),function(e){return new Promise((function(t,n){var i=$.post("/layouts/alien/skins/edit?key=Site.implant",e,(function(){t()})).fail((function(){r("Update(post)","Skin Site.implant",i),n()}))}))}(t)})).then((function(){localStorage.removeItem("savedAlienVersion"),toastr.success("Ihre Parameter und Einstellungen wurden erfolgreich wiederhergestellt!"),toastr.info('Bitte laden Sie nun die Seite neu per "Hard-Reload" (Windows: Strg-F5, Mac: Cmd-R).')})).catch((function(e){return toastr.error("Die Wiederherstellung der Parameter/Einstellungen endete mit Fehler: ".concat(e,"."))})))}},{key:"saveCurrentParams",value:function(){c().then((function(e){var t=e.skinStories;return localStorage.setItem("savedAlienSkinStories",JSON.stringify(t)),a()})).then((function(e){localStorage.setItem("savedAlienSkinParams",e.skin),localStorage.setItem("savedAlienVersion",document.body.dataset.version),toastr.success("Ihre Parameter und Einstellungen wurden erfolgreich gesichert!")})).catch((function(e){return toastr.error("Die Sicherung der Parameter/Einstellungen endete mit Fehler: ".concat(e,"."))}))}}])&&h(t.prototype,n),i&&h(t,i),e}();jQuery.fn.alien=function(){var e=new v;return{implant:e.implant.bind(e)}}}]);